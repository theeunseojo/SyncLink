<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì–¸ì œë¹„ì–´ - ì‹œì‘í•˜ê¸°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .google-btn { background-color: #dd4b39; color: white; border: none; }
        .google-btn:hover { background-color: #c23321; color: white; }
    </style>
</head>
<body class="bg-light">

<div class="container d-flex flex-column justify-content-center align-items-center vh-100">
    <div class="card shadow p-4" style="width: 100%; max-width: 450px;">
        <h1 class="text-center mb-2">ğŸ» ì–¸ì œë¹„ì–´</h1>
        <p class="text-center text-muted mb-4">ì¹œêµ¬ë“¤ê³¼ ë”± ë§ëŠ” ì‹œê°„ì„ 3ì´ˆ ë§Œì— ì°¾ìœ¼ì„¸ìš”.</p>

        <div id="login-section" class="d-grid gap-2 mb-4">
            <a href="/oauth2/authorization/google" class="btn google-btn py-2">
                <i class="bi bi-google"></i> êµ¬ê¸€ ë¡œê·¸ì¸í•˜ê³  ë‚´ ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸°
            </a>
            <small class="text-center text-secondary">* ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•´ìš”</small>
        </div>

        <hr>

        <div id="create-room-section">
            <h5 class="fw-bold mb-3">ğŸš€ ë°© ë§Œë“¤ê¸°</h5>

            <div class="mb-3">
                <label class="form-label text-secondary small">ëª¨ì„ ì´ë¦„</label>
                <input type="text" id="title" class="form-control" placeholder="ì˜ˆ: ìº¡ìŠ¤í†¤ íšŒì˜, ì¢…ê°• íŒŒí‹°">
            </div>

            <div class="row mb-3">
                <div class="col-6">
                    <label class="form-label text-secondary small">ì‹œì‘ì¼ (ì–¸ì œë¶€í„°)</label>
                    <input type="datetime-local" id="startDateTime" class="form-control">
                </div>
                <div class="col-6">
                    <label class="form-label text-secondary small">ì¢…ë£Œì¼ (ì–¸ì œê¹Œì§€)</label>
                    <input type="datetime-local" id="endDateTime" class="form-control">
                </div>
            </div>

            <div class="form-check mb-4">
                <input class="form-check-input" type="checkbox" id="dateOnlyMode">
                <label class="form-check-label" for="dateOnlyMode">
                    ì‹œê°„ ìƒê´€ì—†ì´ <strong>ë‚ ì§œë¡œë§Œ</strong> ì¶”ì²œë°›ì„ë˜ìš” (ì—¬í–‰ ë“±)
                </label>
            </div>

            <button onclick="createRoom()" class="btn btn-primary w-100 py-2 fw-bold">ë°© ìƒì„±í•˜ê³  ë§í¬ ë³µì‚¬í•˜ê¸°</button>
        </div>
    </div>
</div>

<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ ì²´í¬ ë° ìº˜ë¦°ë” ë™ê¸°í™”
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            // (ì°¸ê³ ) /api/events ì—”ë“œí¬ì¸íŠ¸ê°€ ì»¨íŠ¸ë¡¤ëŸ¬ì— ìˆì–´ì•¼ í•¨
            const response = await fetch('/api/events', { method: 'POST' });
            if (response.ok) {
                console.log("ìº˜ë¦°ë” ë™ê¸°í™” ì™„ë£Œ");
            }
        } catch (e) {
            console.error("ë™ê¸°í™” íŒ¨ìŠ¤ (ë¹„ë¡œê·¸ì¸ ìƒíƒœ ë“±)");
        }
    });

    async function createRoom() {
        const title = document.getElementById('title').value;
        const start = document.getElementById('startDateTime').value;
        const end = document.getElementById('endDateTime').value;
        // const isDateOnly = document.getElementById('dateOnlyMode').checked;

        if(!title || !start || !end ) {
            alert("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
        }

        const data = {
            title: title,
            startDateTime: start,
            endDateTime: end,
            // dateOnly: isDateOnly // ë°±ì—”ë“œ DTOì— í•„ë“œê°€ ìˆë‹¤ë©´ ì£¼ì„ í•´ì œ
        };

        try {
            const response = await fetch('/api/rooms', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                const uuid = await response.text();
                // ë°© ìƒì„± í›„ ë°”ë¡œ ê²°ê³¼ í˜ì´ì§€ë¡œ
                window.location.href = `/room.html?uuid=${uuid}`;
            } else {
                alert("ë°© ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        } catch (e) {
            console.error(e);
            alert("ì„œë²„ í†µì‹  ì—ëŸ¬");
        }
    }
</script>
</body>
</html>