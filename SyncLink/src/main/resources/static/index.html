<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>ì–¸ì œë¹„ì–´ - ì‹œì‘í•˜ê¸°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .google-btn { background-color: #dd4b39; color: white; }
    </style>
</head>
<body class="bg-light">

<div class="container d-flex flex-column justify-content-center align-items-center vh-100">
    <div class="card shadow p-4" style="width: 100%; max-width: 400px;">
        <h1 class="text-center mb-4">ğŸ”— ì–¸ì œë¹„ì–´</h1>
        <p class="text-center text-muted">ì¹œêµ¬ë“¤ê³¼ ë¹„ëŠ” ì‹œê°„ì„ 3ì´ˆ ë§Œì— ì°¾ìœ¼ì„¸ìš”.</p>

        <div id="login-section" class="d-grid gap-2 mb-4">
            <a href="/oauth2/authorization/google" class="btn google-btn">
                ğŸ“… êµ¬ê¸€ ë¡œê·¸ì¸í•˜ê³  ë‚´ ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸°
            </a>
        </div>

        <hr>

        <div id="create-room-section">
            <h5 class="mb-3">ë°© ë§Œë“¤ê¸°</h5>
            <div class="mb-3">
                <label class="form-label">ëª¨ì„ ì´ë¦„</label>
                <input type="text" id="title" class="form-control" placeholder="ì˜ˆ: ìº¡ìŠ¤í†¤ íšŒì˜">
            </div>
            <div class="mb-3">
                <label class="form-label">ì–¸ì œ ë§Œë‚ ê¹Œìš”?</label>
                <input type="datetime-local" id="startDateTime" class="form-control mb-2">
                <input type="datetime-local" id="endDateTime" class="form-control">
            </div>

            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="dateOnlyMode">
                <label class="form-check-label" for="dateOnlyMode">
                    ì‹œê°„ ìƒê´€ì—†ì´ ë‚ ì§œë§Œ ë³¼ë˜ìš” (ì¤€ë¹„ì¤‘)
                </label>
            </div>

            <button onclick="createRoom()" class="btn btn-primary w-100">ë°© ë§Œë“¤ê³  ë§í¬ ê³µìœ í•˜ê¸° ğŸš€</button>
        </div>
    </div>
</div>

<script>
    // í˜ì´ì§€ê°€ ë¡œë“œë  ë•Œ ìë™ìœ¼ë¡œ ìº˜ë¦°ë” ë™ê¸°í™”ë¥¼ ì‹œë„í•©ë‹ˆë‹¤.
    document.addEventListener('DOMContentLoaded', async function() {
        console.log("ìº˜ë¦°ë” ë™ê¸°í™”ë¥¼ ì‹œë„í•©ë‹ˆë‹¤...");
        try {
            const response = await fetch('/api/events', {
                method: 'POST'
            });

            if (response.ok) {
                const message = await response.text();
                console.log("ìº˜ë¦°ë” ë™ê¸°í™” ì„±ê³µ:", message);
                // ì‚¬ìš©ìì—ê²Œ ì„±ê³µì„ ì•Œë¦¬ëŠ” ê°„ë‹¨í•œ ì•Œë¦¼ì„ ë„ìš¸ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
                // alert("ìº˜ë¦°ë” ë™ê¸°í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else if (response.status === 401) {
                // 401 UnauthorizedëŠ” ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
                // ì´ ê²½ìš°ì—” íŠ¹ë³„í•œ ì˜¤ë¥˜ ë©”ì‹œì§€ ì—†ì´ ì¡°ìš©íˆ ë„˜ì–´ê°‘ë‹ˆë‹¤.
                console.log("ë¡œê·¸ì¸ ìƒíƒœê°€ ì•„ë‹ˆë¯€ë¡œ ìº˜ë¦°ë”ë¥¼ ë™ê¸°í™”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            }
            else {
                // ê·¸ ì™¸ ë‹¤ë¥¸ ì˜¤ë¥˜
                console.error("ìº˜ë¦°ë” ë™ê¸°í™” ì‹¤íŒ¨:", response.statusText);
            }
        } catch (e) {
            console.error("ìº˜ë¦°ë” ë™ê¸°í™” ì¤‘ ì—ëŸ¬ ë°œìƒ:", e);
        }
    });
</script>

<script>
    async function createRoom() {
        const title = document.getElementById('title').value;
        const start = document.getElementById('startDateTime').value;
        const end = document.getElementById('endDateTime').value;


        if(!title || !start || !end ) {
            alert("ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
        }

        const data = {
            title: title,
            startDateTime: start,
            endDateTime: end,

        };

        try {
            const response = await fetch('/api/rooms', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                const uuid = await response.text();
                // ë°© ìƒì„± í›„ ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = `/room.html?uuid=${uuid}`;
            } else {
                alert("ë°© ìƒì„± ì‹¤íŒ¨!");
            }
        } catch (e) {
            console.error(e);
            alert("ì—ëŸ¬ ë°œìƒ!");
        }
    }

</script>
</body>
</html>